<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RPM Installation &mdash; esmond</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/esnet/esnet.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.1a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="esmond" href="index.html" />
    <link rel="next" title="esmond subsystems" href="architecture.html" />
    <link rel="prev" title="Deployment Cookbook" href="deployment_cookbook.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          <!-- LOGO: logo-esnet-ball-sm.png _static/logo-esnet-ball-sm.png --><img src="_static/logo-esnet-ball-sm.png">
          esmond</a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_cookbook.html">Deployment Cookbook</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">RPM Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">esmond subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.client.html">REST API Client Libary</a></li>
<li class="toctree-l1"><a class="reference internal" href="hacking.html">Hacking on esmond</a></li>
<li class="toctree-l1"><a class="reference internal" href="perfsonar_extension.html">Extending the perfSONAR API</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpm_build.html">RPM Build Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="perfsonar_client.html">Using perfSONAR data client libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Developer Reference</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="deployment_cookbook.html" title="Previous Chapter: Deployment Cookbook">
      <span class="glyphicon glyphicon-chevron-left"></span>
      <span class="hidden-sm">
        Deployment Cookb...
      </span>
    </a>
  </li>
  <li>
    <a href="architecture.html" title="Next Chapter: esmond subsystems">
      <span class="hidden-sm">
        esmond subsystem...
      </span>
      <span class="glyphicon glyphicon-chevron-right"></span>
    </a>
  </li>
              
            
            <li class="divider-vertical"></li>
            
                <li><a href="genindex.html">Index</a></li>
                <li><a href="https://www.es.net">ESnet</a></li>
            
            <li><a href="http://github.com/esnet/esmond"><img src="_static/esnet/icon-github.png" height="20" width="20"></a></li>
            
            
            
          </ul>
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">RPM Installation</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#system-requirements">System Requirements</a></li>
<li><a class="reference internal" href="#configuring-yum">Configuring Yum</a><ul>
<li><a class="reference internal" href="#configuring-epel">Configuring EPEL</a></li>
<li><a class="reference internal" href="#configuring-datastax">Configuring Datastax</a></li>
<li><a class="reference internal" href="#configuring-the-perfsonar-yum-repository">Configuring the perfSONAR Yum repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-esmond">Installing esmond</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#verifying-the-installation">Verifying the Installation</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="rpm-installation">
<h1>RPM Installation<a class="headerlink" href="#rpm-installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>This document describes how to install and configure esmond as an RPM on CentOS 6 using yum.</p>
</div>
<div class="section" id="system-requirements">
<h2>System Requirements<a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h2>
<p>The RPM currently MUST be installed with <strong>yum</strong> on a <a class="reference external" href="https://www.centos.org">CentOS 6</a> system with an i386/i686 or x86_64 architecture. It may also work on other flavors of RedHat Linux but it is only tested on CentOS. It assumes a particular Python 2.7 package available for CentOS 6. Other operating systems should look at the instructions for installing from source.</p>
</div>
<div class="section" id="configuring-yum">
<h2>Configuring Yum<a class="headerlink" href="#configuring-yum" title="Permalink to this headline">¶</a></h2>
<p>You will need to configure a few additional yum repositories on your target host to install the esmond RPM. This includes the yum repository containing esmond and a few others hosting its dependencies.</p>
<div class="section" id="configuring-epel">
<h3>Configuring EPEL<a class="headerlink" href="#configuring-epel" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><a class="reference external" href="https://fedoraproject.org/wiki/EPEL">Extra Packages for Enterprise Linux (EPEL)</a> is a repository run by Fedora containing additional packages commonly needed for systems. They provide an RPM for setting-up the yum repository. You can setup EPEL with the following:</dt>
<dd><ol class="first last arabic">
<li><p class="first">Download the latest EPEL RPM. An architecture independent version of this RPM can be found on <a class="reference external" href="http://dl.fedoraproject.org/pub/epel/6/x86_64/repoview/epel-release.html">this page</a>.</p>
</li>
<li><p class="first">Install the RPM using <cite>yum localinstall</cite>. Example:</p>
<div class="highlight-python"><div class="highlight"><pre>yum localinstall epel-release-6-VERSION.noarch.rpm
</pre></div>
</div>
</li>
</ol>
</dd>
</dl>
</div>
<div class="section" id="configuring-datastax">
<h3>Configuring Datastax<a class="headerlink" href="#configuring-datastax" title="Permalink to this headline">¶</a></h3>
<p>Esmond also uses the <a class="reference external" href="http://cassandra.apache.org">Cassandra Database</a> as the backend for time-series data. Cassandra RPMs are maintained in the <a class="reference external" href="http://www.datastax.com">Datastax</a> yum repository. You can configure this repository by creating a file <em>/etc/yum.repos.d/datastax.repo</em> with the following contents:</p>
<div class="highlight-python"><div class="highlight"><pre>[datastax]
name= DataStax Repo for Apache Cassandra
baseurl=http://rpm.datastax.com/community
enabled=1
gpgcheck=0
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-perfsonar-yum-repository">
<h3>Configuring the perfSONAR Yum repository<a class="headerlink" href="#configuring-the-perfsonar-yum-repository" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>The final repo you need to configure is the repository containing the perfSONAR packages. Esmond currently lives in a pre-release yum repository. It also contains Python 2.7 packages for i386/i686 architectures. You can configure that repository with the following:</dt>
<dd><ol class="first last arabic">
<li><p class="first">Download the architecture independent RPM <a class="reference external" href="http://software.internet2.edu/branches/release-3.4/rpms/el6/x86_64/RPMS.main/Internet2-repo-0.5-2.noarch.rpm">here</a></p>
</li>
<li><p class="first">Run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>yum localinstall Internet2-repo-0.5-2.noarch.rpm
</pre></div>
</div>
</li>
</ol>
</dd>
</dl>
</div>
</div>
<div class="section" id="installing-esmond">
<h2>Installing esmond<a class="headerlink" href="#installing-esmond" title="Permalink to this headline">¶</a></h2>
<p>After setting-up the yum repositories you can install esmond with the following:</p>
<div class="highlight-python"><div class="highlight"><pre>yum install esmond
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Verify that the <em>python27-mod_wsgi</em> package is the one from the Internet2 repo as issues can occur if a different version is installed from another repo.</p>
</div>
<p>After the command completes logout and re-login so that certain environment variables will be set. You are now ready to begin configuration.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Now that esmond is installed you will need to do some configuration of esmond and supporting services such as Apache(httpd), Cassandra, and PostgreSQL.</p>
<ol class="arabic">
<li><p class="first">First of all, enable <em>httpd</em>, <em>cassandra</em> and <em>postgresql</em> to start on system boot with the following commands:</p>
<div class="highlight-python"><div class="highlight"><pre>chkconfig --add cassandra
chkconfig cassandra on
chkconfig httpd on
chkconfig postgresql on
</pre></div>
</div>
</li>
<li><p class="first">Assuming this is the first time you have configured PostgreSQL, you will need to initialize PostgreSQL and create a user for esmond to access the database. <em>NOTE: If you had a PostgreSQL database prior to installing esmond the commands may be slightly different depending on your setup</em>. Initialize the database with the following commands (NOTE: Replace the password <em>changeit</em> with your password):</p>
<div class="highlight-python"><div class="highlight"><pre>/sbin/service postgresql initdb
/sbin/service postgresql start
sudo -u postgres psql -c &quot;CREATE USER esmond WITH PASSWORD &#39;changeit&#39;&quot;
sudo -u postgres psql -c &quot;CREATE DATABASE esmond&quot;
sudo -u postgres psql -c &quot;GRANT ALL ON DATABASE esmond to esmond&quot;
</pre></div>
</div>
</li>
<li><p class="first">Next enable postgres password authentication by editing /var/lib/pgsql/data/pg_hba.conf and replacing all occurrences <em>ident</em> with <em>md5</em> (usually near the the bottom of the file). It should look something like the following when done:</p>
<div class="highlight-python"><div class="highlight"><pre># TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD

# &quot;local&quot; is for Unix domain socket connections only
local   all         all                               md5
# IPv4 local connections:
host    all         all         127.0.0.1/32          md5
# IPv6 local connections:
host    all         all         ::1/128               md5
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Restart postgresql with the following command::</dt>
<dd><p class="first last">/sbin/service postgresql restart</p>
</dd>
</dl>
</li>
<li><p class="first">Open <strong>/opt/esmond/esmond.conf</strong> in a text editor and set <em>sql_db_password</em> to the postgresql password set previously. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">...</span>
<span class="n">sql_db_password</span> <span class="o">=</span> <span class="n">changeit</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Python 2.7 is required for the remaining configuration commands. Initialize the Python 2.7 virtualenv with the commands below (<em>NOTE: the commands below must be run from a bash shell</em>):</p>
<div class="highlight-python"><div class="highlight"><pre>cd /opt/esmond
source /opt/rh/python27/enable
/opt/rh/python27/root/usr/bin/virtualenv --prompt=&quot;(esmond)&quot; .
. bin/activate
</pre></div>
</div>
</li>
<li><p class="first">Build the esmond databases and create an admin user for Django when prompted with the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>python esmond/manage.py syncdb
</pre></div>
</div>
</li>
<li><p class="first">Create a user that can write data to the MA. This may be used for things like the perfSONAR regular testing. Note the generated key (it will be the same for both):</p>
<div class="highlight-python"><div class="highlight"><pre>python esmond/manage.py add_ps_metadata_post_user perfsonar
python esmond/manage.py add_timeseries_post_user perfsonar
</pre></div>
</div>
</li>
<li><p class="first">Finally, start cassandra and httpd:</p>
<div class="highlight-python"><div class="highlight"><pre>/sbin/service cassandra start
/sbin/service httpd start
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="verifying-the-installation">
<h2>Verifying the Installation<a class="headerlink" href="#verifying-the-installation" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">You can verify esmond is running by opening <em>http://&lt;your-host&gt;/esmond/perfsonar/archive/?format=json</em> in your browser. If it is working you should just see an empty JSON array <cite>[]</cite>. If things are not working you will get a 500 error or similar. Useful logs are below:</p>
<blockquote>
<div><ul class="simple">
<li>/var/log/httpd/error_log.log</li>
<li>/var/log/esmond/esmond.log</li>
<li>/var/log/esmond/django.log</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Verify you can login as a Django administrator by trying to open <a class="reference external" href="http:/">http:/</a>/&lt;your-host&gt;/esmond/admin and logging-in with the username and password created when you ran <cite>python esmond/manage.py syncdb</cite> and were prompted. From this page you can manage API keys and user permissions for writing data.</p>
</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <a href="http://www.es.net/"><img src="_static/esnet/logo-esnet.png" alt="[ESnet]"></a>
      </div>
      <div class="col-md-11">
        <p class="pull-right">
        <a href="#">Back to top</a>
        
        <br/>
        
<div id="sourcelink">
  <a href="_sources/rpm_install.txt"
     rel="nofollow">Source</a>
</div>
        
        </p>
        <p>
            &copy; Copyright 2012-2013, The Regents of the University of California.<br/>
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
        </p>
      </div>
    </div>
  </div>
</footer>
  </body>
</html>